<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Guard - Face Monitoring System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Face Guard - Face Monitoring System</h1>
        
      
        <div class="card mb-5">
            <div class="card-header">
                <h3>Register New User</h3>
            </div>
            <div class="card-body">
                <form id="registerForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Face Image</label>
                        <input type="file" class="form-control" id="image" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
                <div id="registerResult" class="mt-3"></div>
            </div>
        </div>
        
        
        <div class="card mb-5">
            <div class="card-header">
                <h3>Upload Image for Face Detection</h3>
            </div>
            <div class="card-body">
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="uploadImage" class="form-label">Image to Analyze</label>
                        <input type="file" class="form-control" id="uploadImage" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-success">Upload & Analyze</button>
                </form>
                <div id="uploadResult" class="mt-3"></div>
            </div>
        </div>
        

        <div class="card mb-5">
            <div class="card-header">
                <h3>View User Detections</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="userId" class="form-label">User ID</label>
                    <input type="number" class="form-control" id="userId" required>
                </div>
                <button id="fetchDetections" class="btn btn-info">Fetch Detections</button>
                <div id="detectionsResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Base URL for API requests
        const BASE_URL = 'http://localhost:8000';
        
        // Register form submission
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('username', document.getElementById('username').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('password', document.getElementById('password').value);
            formData.append('image', document.getElementById('image').files[0]);
            
            try {
                const response = await fetch(`${BASE_URL}/register`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                document.getElementById('registerResult').innerHTML = 
                    `<div class="alert alert-${response.ok ? 'success' : 'danger'}">
                        ${response.ok ? `Registered successfully! User ID: ${result.user_id}` : `Error: ${result.detail}`}
                    </div>`;
            } catch (error) {
                document.getElementById('registerResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
        
        // Upload form submission
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('file', document.getElementById('uploadImage').files[0]);
            
            try {
                const response = await fetch(`${BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                document.getElementById('uploadResult').innerHTML = 
                    `<div class="alert alert-${response.ok ? 'success' : 'danger'}">
                        ${response.ok ? `Uploaded successfully! Faces detected: ${result.faces}` : `Error: ${result.detail}`}
                    </div>`;
            } catch (error) {
                document.getElementById('uploadResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
        
        // Fetch detections
        document.getElementById('fetchDetections').addEventListener('click', async function() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                document.getElementById('detectionsResult').innerHTML = 
                    '<div class="alert alert-warning">Please enter a User ID</div>';
                return;
            }
            
            try {
                const response = await fetch(`${BASE_URL}/user/${userId}/detections`);
                const result = await response.json();
                
                if (response.ok) {
                    if (result.length === 0) {
                        document.getElementById('detectionsResult').innerHTML = 
                            '<div class="alert alert-info">No detections found for this user</div>';
                    } else {
                        let html = '<div class="table-responsive"><table class="table table-striped">';
                        html += '<thead><tr><th>ID</th><th>Similarity</th><th>Detected At</th><th>IP Address</th></tr></thead><tbody>';
                        result.forEach(detection => {
                            html += `<tr>
                                <td>${detection.detection_id}</td>
                                <td>${detection.similarity.toFixed(4)}</td>
                                <td>${new Date(detection.detected_at).toLocaleString()}</td>
                                <td>${detection.uploader_ip}</td>
                            </tr>`;
                        });
                        html += '</tbody></table></div>';
                        document.getElementById('detectionsResult').innerHTML = html;
                    }
                } else {
                    document.getElementById('detectionsResult').innerHTML = 
                        `<div class="alert alert-danger">Error: ${result.detail}</div>`;
                }
            } catch (error) {
                document.getElementById('detectionsResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageAuth - Consent Based Image Usage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">ImageAuth - Consent Based Image Usage</h1>

        <!-- Registration Form -->
        <div class="card mb-5">
            <div class="card-header">
                <h3>Register New User</h3>
            </div>
            <div class="card-body">
                <form id="registerForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="username" class="form-label"><strong> Username</strong></label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label"><strong>Email</strong></label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label"><strong>Password</strong></label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label"><strong>Face Image</strong></label>
                        <input type="file" class="form-control" id="image" accept="image/*" required>
                        <p class="small">Note: Please upload a clear image where your face is visible
                            with proper
                            lighting</p>
                    </div>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
                <div id="registerResult" class="mt-3"></div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="card mb-5">
            <div class="card-header">
                <h3>Upload Image for Face Detection</h3>
            </div>
            <div class="card-body">
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="uploadImage" class="form-label">Image to Analyze</label>
                        <input type="file" class="form-control" id="uploadImage" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-success">Upload & Analyze</button>
                </form>
                <div id="uploadResult" class="mt-3"></div>
            </div>
        </div>

        <!-- Detections Lookup -->
        <div class="card mb-5">
            <div class="card-header">
                <h3>View User Detections</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="userId" class="form-label">User ID</label>
                    <input type="number" class="form-control" id="userId" required>
                </div>
                <button id="fetchDetections" class="btn btn-info">Fetch Detections</button>
                <div id="detectionsResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Base URL for API requests
        const BASE_URL = 'http://localhost:8000';

        // Register form submission
        document.getElementById('registerForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append('username', document.getElementById('username').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('password', document.getElementById('password').value);
            formData.append('image', document.getElementById('image').files[0]);

            try {
                const response = await fetch(`${BASE_URL}/register`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                let message = response.ok ? `Registered successfully! User ID: ${result.user_id}` : `Error: ${result.detail}`;
                let alertType = response.ok ? 'success' : 'danger';

                // Display quality score and category
                if (response.ok) {
                    const qualityScore = result.quality_score;
                    const qualityCategory = result.quality_category;
                    message += `<br>Image Quality Score: ${qualityScore} (${qualityCategory})`;
                    if (qualityCategory === 'Poor') {
                        message += '<br><strong>Warning:</strong> Image quality is low. Consider uploading a clearer photo for better accuracy.';
                        alertType = 'warning';  // Change to warning if poor
                    }
                }

                document.getElementById('registerResult').innerHTML =
                    `<div class="alert alert-${alertType}">
                        ${message}
                    </div>`;
            } catch (error) {
                document.getElementById('registerResult').innerHTML =
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Upload form submission
        document.getElementById('uploadForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append('file', document.getElementById('uploadImage').files[0]);

            try {
                const response = await fetch(`${BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                document.getElementById('uploadResult').innerHTML =
                    `<div class="alert alert-${response.ok ? 'success' : 'danger'}">
                        ${response.ok ? `Uploaded successfully! Faces detected: ${result.faces}` : `Error: ${result.detail}`}
                    </div>`;
            } catch (error) {
                document.getElementById('uploadResult').innerHTML =
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Fetch detections
        document.getElementById('fetchDetections').addEventListener('click', async function () {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                document.getElementById('detectionsResult').innerHTML =
                    '<div class="alert alert-warning">Please enter a User ID</div>';
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/user/${userId}/detections`);
                const result = await response.json();

                if (response.ok) {
                    if (result.length === 0) {
                        document.getElementById('detectionsResult').innerHTML =
                            '<div class="alert alert-info">No detections found for this user</div>';
                    } else {
                        let html = '<div class="table-responsive"><table class="table table-striped">';
                        html += '<thead><tr><th>ID</th><th>Similarity</th><th>Detected At</th><th>IP Address</th></tr></thead><tbody>';
                        result.forEach(detection => {
                            html += `<tr>
                                <td>${detection.detection_id}</td>
                                <td>${detection.similarity.toFixed(4)}</td>
                                <td>${new Date(detection.detected_at).toLocaleString()}</td>
                                <td>${detection.uploader_ip}</td>
                            </tr>`;
                        });
                        html += '</tbody></table></div>';
                        document.getElementById('detectionsResult').innerHTML = html;
                    }
                } else {
                    document.getElementById('detectionsResult').innerHTML =
                        `<div class="alert alert-danger">Error: ${result.detail}</div>`;
                }
            } catch (error) {
                document.getElementById('detectionsResult').innerHTML =
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>

</html>